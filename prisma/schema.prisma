generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model audit_logs {
  id                 String     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  claim_id           String?    @db.Uuid
  document_id        String?    @db.Uuid
  user_id            String?    @db.Uuid
  action_type        String     @db.VarChar(50)
  action_description String?
  ip_address         String?    @db.Inet
  user_agent         String?
  old_values         Json?
  new_values         Json?
  created_at         DateTime?  @default(now()) @db.Timestamp(6)
  claims             claims?    @relation(fields: [claim_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  documents          documents? @relation(fields: [document_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([action_type], map: "idx_audit_action")
  @@index([claim_id], map: "idx_audit_claim")
  @@index([created_at], map: "idx_audit_date")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model claims {
  id                    String                  @id(map: "claims_pkey") @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  claim_number          String                  @unique
  claim_type            String                  @db.VarChar(20)
  claimant_name         String                  @db.VarChar(255)
  ic_number             String                  @db.VarChar(20)
  policy_number         String                  @db.VarChar(50)
  phone_number          String?                 @db.VarChar(20)
  email                 String?                 @db.VarChar(255)
  telegram_chat_id      BigInt
  incident_date         DateTime                @db.Date
  incident_location     String?
  incident_description  String
  claimed_amount        Decimal?                @db.Decimal(12, 2)
  approved_amount       Decimal?                @db.Decimal(12, 2)
  deductible            Decimal?                @db.Decimal(12, 2)
  status                String                  @default("draft") @db.VarChar(50)
  submission_date       DateTime?               @db.Timestamp(6)
  approval_date         DateTime?               @db.Timestamp(6)
  payment_date          DateTime?               @db.Timestamp(6)
  confidence_score      Decimal?                @db.Decimal(5, 4)
  requires_human_review Boolean?                @default(false)
  auto_approved         Boolean?                @default(false)
  created_at            DateTime?               @default(now()) @db.Timestamp(6)
  updated_at            DateTime?               @default(now()) @db.Timestamp(6)
  created_by            String?                 @db.Uuid
  assigned_to           String?                 @db.Uuid
  status_history        Json?                   @default("[]")
  additional_data       Json?                   @default("{}")
  audit_logs            audit_logs[]
  conversation_sessions conversation_sessions[]
  documents             documents[]
  status_updates        status_updates[]

  @@index([claim_number], map: "idx_claims_claim_number")
  @@index([status], map: "idx_claims_status")
  @@index([submission_date], map: "idx_claims_submission_date")
  @@index([telegram_chat_id], map: "idx_claims_telegram")
  @@map("insura_wiz_claims")
}

model conversation_sessions {
  id               String     @id(map: "conversation_sessions_pkey") @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  telegram_chat_id BigInt     @unique(map: "conversation_sessions_telegram_chat_id_key")
  claim_id         String?    @db.Uuid
  current_state    String     @default("idle") @db.VarChar(50)
  context_data     Json?      @default("{}")
  last_interaction DateTime?  @default(now()) @db.Timestamp(6)
  messages_count   Int?       @default(0)
  started_at       DateTime?  @default(now()) @db.Timestamp(6)
  completed_at     DateTime?  @db.Timestamp(6)
  is_active        Boolean?   @default(true)
  created_at       DateTime?  @default(now()) @db.Timestamp(6)
  updated_at       DateTime?  @default(now()) @db.Timestamp(6)
  claims           claims?    @relation(fields: [claim_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "conversation_sessions_claim_id_fkey")
  messages         messages[]

  @@index([telegram_chat_id], map: "idx_sessions_chat_id")
  @@index([claim_id], map: "idx_sessions_claim_id")
  @@index([current_state], map: "idx_sessions_state")
  @@map("insura_wiz_conversation_sessions")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model documents {
  id                 String       @id(map: "documents_pkey") @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  claim_id           String       @db.Uuid
  document_type      String
  file_name          String       @db.VarChar(255)
  file_type          String       @db.VarChar(50)
  file_size_bytes    Int
  file_url           String
  ocr_text           String?
  ocr_data           Json?        @default("{}")
  ocr_confidence     Decimal?     @db.Decimal(5, 4)
  processing_status  String?      @default("pending") @db.VarChar(20)
  processed_at       DateTime?    @db.Timestamp(6)
  blur_score         Decimal?     @db.Decimal(5, 4)
  quality_acceptable Boolean?
  user_confirmed     Boolean?     @default(false)
  rejection_reason   String?
  uploaded_at        DateTime?    @default(now()) @db.Timestamp(6)
  uploaded_by        String?      @db.VarChar(50)
  replaced_by        String?      @db.Uuid
  version            Int?         @default(1)
  audit_logs         audit_logs[]
  claims             claims       @relation(fields: [claim_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "documents_claim_id_fkey")

  @@index([claim_id], map: "idx_documents_claim")
  @@index([processing_status], map: "idx_documents_status")
  @@index([document_type], map: "idx_documents_type")
  @@map("insura_wiz_documents")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model messages {
  id                    String                @id(map: "messages_pkey") @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  session_id            String                @db.Uuid
  role                  String
  content               String
  created_at            DateTime?             @default(now()) @db.Timestamptz(6)
  conversation_sessions conversation_sessions @relation(fields: [session_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "messages_session_id_fkey")

  @@index([created_at(sort: Desc)], map: "idx_messages_created_at")
  @@index([session_id], map: "idx_messages_session_id")
  @@map("insura_wiz_messages")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model policies {
  id                String    @id(map: "policies_pkey") @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  policy_number     String
  policy_type       String    @db.VarChar(20)
  policyholder_name String    @db.VarChar(255)
  policyholder_ic   String    @db.VarChar(20)
  coverage_start    DateTime  @db.Date
  coverage_end      DateTime  @db.Date
  sum_insured       Decimal?  @db.Decimal(12, 2)
  premium_amount    Decimal?  @db.Decimal(12, 2)
  status            String?   @default("active") @db.VarChar(20)
  created_at        DateTime? @default(now()) @db.Timestamp(6)
  updated_at        DateTime? @default(now()) @db.Timestamp(6)

  @@index([policyholder_ic], map: "idx_policies_ic")
  @@index([policy_number], map: "idx_policies_number")
  @@map("insura_wiz_policies")
}

model status_updates {
  id                  String    @id(map: "status_updates_pkey") @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  claim_id            String    @db.Uuid
  update_type         String    @db.VarChar(50)
  old_status          String?   @db.VarChar(50)
  new_status          String    @db.VarChar(50)
  message_text        String
  telegram_message_id Int?
  sent_to_telegram    Boolean?  @default(false)
  sent_to_email       Boolean?  @default(false)
  sent_to_sms         Boolean?  @default(false)
  created_at          DateTime? @default(now()) @db.Timestamp(6)
  created_by          String?   @db.Uuid
  additional_data     Json?     @default("{}")
  claims              claims    @relation(fields: [claim_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "status_updates_claim_id_fkey")

  @@index([claim_id], map: "idx_updates_claim")
  @@index([created_at], map: "idx_updates_date")
  @@index([update_type], map: "idx_updates_type")
  @@map("insura_wiz_status_updates")
}

model Admin {
  id        String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  email     String   @unique
  password  String
  role      String   @default("admin")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamp(6)

  @@map("admins")
}

model insura_wiz_session {
  sid    String   @id(map: "session_pkey") @db.VarChar
  sess   Json     @db.Json
  expire DateTime @db.Timestamp(6)

  @@index([expire], map: "IDX_session_expire")
}

model wrs_pro_audit_logs {
  id          String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  entity_type String    @db.VarChar(100)
  entity_id   String    @db.Uuid
  action      String    @db.VarChar(100)
  actor_type  String?   @db.VarChar(50)
  actor_id    String?   @db.Uuid
  old_data    Json?
  new_data    Json?
  ip_address  String?   @db.VarChar(45)
  created_at  DateTime? @default(now()) @db.Timestamptz(6)
}

model wrs_pro_brands {
  id               String             @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name             String             @db.VarChar(100)
  code             String             @unique @db.VarChar(20)
  logo_url         String?
  is_active        Boolean?           @default(true)
  created_at       DateTime?          @default(now()) @db.Timestamptz(6)
  wrs_pro_products wrs_pro_products[]
}

model wrs_pro_campaign_products {
  id                String             @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  campaign_id       String?            @db.Uuid
  product_id        String?            @db.Uuid
  created_at        DateTime?          @default(now()) @db.Timestamptz(6)
  wrs_pro_campaigns wrs_pro_campaigns? @relation(fields: [campaign_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  wrs_pro_products  wrs_pro_products?  @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([campaign_id, product_id])
}

model wrs_pro_campaigns {
  id                             String                      @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name                           String                      @db.VarChar(255)
  description                    String?
  start_date                     DateTime                    @db.Date
  end_date                       DateTime                    @db.Date
  reward_type                    String                      @db.VarChar(50)
  reward_value                   Decimal?                    @db.Decimal(10, 2)
  reward_description             String?
  requires_identity_verification Boolean?                    @default(false)
  max_claims                     Int?
  current_claims                 Int?                        @default(0)
  terms_conditions               String?
  is_active                      Boolean?                    @default(true)
  created_at                     DateTime?                   @default(now()) @db.Timestamptz(6)
  updated_at                     DateTime?                   @default(now()) @db.Timestamptz(6)
  wrs_pro_campaign_products      wrs_pro_campaign_products[]
  wrs_pro_rewards                wrs_pro_rewards[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model wrs_pro_chat_history {
  id                    String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  session_id            String?                @db.Uuid
  customer_id           String?                @db.Uuid
  telegram_chat_id      BigInt
  message_direction     String                 @db.VarChar(10)
  message_type          String?                @db.VarChar(50)
  message_content       String?
  message_data          Json?
  created_at            DateTime?              @default(now()) @db.Timestamptz(6)
  wrs_pro_customers     wrs_pro_customers?     @relation(fields: [customer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  wrs_pro_chat_sessions wrs_pro_chat_sessions? @relation(fields: [session_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([session_id], map: "idx_chat_history_session")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model wrs_pro_chat_sessions {
  id                   String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  customer_id          String?                @db.Uuid
  telegram_chat_id     BigInt
  current_state        String?                @default("main_menu") @db.VarChar(100)
  current_flow         String?                @db.VarChar(100)
  flow_data            Json?                  @default("{}")
  last_message_at      DateTime?              @default(now()) @db.Timestamptz(6)
  created_at           DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?              @default(now()) @db.Timestamptz(6)
  wrs_pro_chat_history wrs_pro_chat_history[]
  wrs_pro_customers    wrs_pro_customers?     @relation(fields: [customer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([telegram_chat_id], map: "idx_chat_sessions_telegram")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model wrs_pro_customers {
  id                             String                           @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  telegram_id                    BigInt                           @unique
  telegram_username              String?                          @db.VarChar(255)
  phone                          String?                          @db.VarChar(20)
  name                           String?                          @db.VarChar(255)
  email                          String?                          @db.VarChar(255)
  ic_number                      String?                          @db.VarChar(20)
  address                        String?
  city                           String?                          @db.VarChar(100)
  state                          String?                          @db.VarChar(100)
  postcode                       String?                          @db.VarChar(10)
  created_at                     DateTime?                        @default(now()) @db.Timestamptz(6)
  updated_at                     DateTime?                        @default(now()) @db.Timestamptz(6)
  wrs_pro_chat_history           wrs_pro_chat_history[]
  wrs_pro_chat_sessions          wrs_pro_chat_sessions[]
  wrs_pro_identity_verifications wrs_pro_identity_verifications[]
  wrs_pro_registrations          wrs_pro_registrations[]
  wrs_pro_rewards                wrs_pro_rewards[]
  wrs_pro_support_tickets        wrs_pro_support_tickets[]

  @@index([telegram_id], map: "idx_customers_telegram_id")
}

model wrs_pro_identity_verifications {
  id                 String             @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  customer_id        String?            @db.Uuid
  reward_id          String?            @db.Uuid
  ic_file_url        String?
  ic_ocr_data        Json?
  verified_name      String?            @db.VarChar(255)
  verified_ic_number String?            @db.VarChar(20)
  status             String?            @default("pending") @db.VarChar(50)
  verified_at        DateTime?          @db.Timestamptz(6)
  created_at         DateTime?          @default(now()) @db.Timestamptz(6)
  wrs_pro_customers  wrs_pro_customers? @relation(fields: [customer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  wrs_pro_rewards    wrs_pro_rewards?   @relation(fields: [reward_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model wrs_pro_installations {
  id                    String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  installer_id          String?                @db.Uuid
  registration_id       String?                @db.Uuid
  installation_date     DateTime?              @db.Date
  installation_photos   Json?
  notes                 String?
  kpi_points_earned     Int?                   @default(0)
  created_at            DateTime?              @default(now()) @db.Timestamptz(6)
  wrs_pro_installers    wrs_pro_installers?    @relation(fields: [installer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  wrs_pro_registrations wrs_pro_registrations? @relation(fields: [registration_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model wrs_pro_installers {
  id                    String                  @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  company_name          String?                 @db.VarChar(255)
  contact_name          String                  @db.VarChar(255)
  phone                 String?                 @db.VarChar(20)
  email                 String?                 @db.VarChar(255)
  telegram_id           BigInt?
  kpi_points            Int?                    @default(0)
  tier                  String?                 @default("bronze") @db.VarChar(50)
  is_active             Boolean?                @default(true)
  created_at            DateTime?               @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?               @default(now()) @db.Timestamptz(6)
  wrs_pro_installations wrs_pro_installations[]
}

model wrs_pro_moderation_queue {
  id                    String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  registration_id       String?                @db.Uuid
  queue_type            String                 @db.VarChar(50)
  ocr_confidence        Decimal?               @db.Decimal(5, 2)
  ocr_extracted_data    Json?
  uploaded_file_url     String?
  status                String?                @default("pending") @db.VarChar(50)
  moderator_id          String?                @db.Uuid
  moderator_notes       String?
  decision_at           DateTime?              @db.Timestamptz(6)
  created_at            DateTime?              @default(now()) @db.Timestamptz(6)
  wrs_pro_registrations wrs_pro_registrations? @relation(fields: [registration_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([status], map: "idx_moderation_status")
}

model wrs_pro_products {
  id                        String                      @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  brand_id                  String?                     @db.Uuid
  sku                       String                      @unique @db.VarChar(100)
  name                      String                      @db.VarChar(255)
  category                  String?                     @db.VarChar(100)
  serial_pattern            String?                     @db.VarChar(255)
  warranty_months           Int?                        @default(12)
  has_multiple_serials      Boolean?                    @default(false)
  serial_components         Json?
  is_active                 Boolean?                    @default(true)
  created_at                DateTime?                   @default(now()) @db.Timestamptz(6)
  updated_at                DateTime?                   @default(now()) @db.Timestamptz(6)
  wrs_pro_campaign_products wrs_pro_campaign_products[]
  wrs_pro_brands            wrs_pro_brands?             @relation(fields: [brand_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  wrs_pro_registrations     wrs_pro_registrations[]
}

model wrs_pro_registration_serials {
  id                    String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  registration_id       String?                @db.Uuid
  component_name        String                 @db.VarChar(100)
  serial_number         String                 @db.VarChar(100)
  created_at            DateTime?              @default(now()) @db.Timestamptz(6)
  wrs_pro_registrations wrs_pro_registrations? @relation(fields: [registration_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model wrs_pro_registrations {
  id                           String                         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  customer_id                  String?                        @db.Uuid
  product_id                   String?                        @db.Uuid
  primary_serial               String                         @db.VarChar(100)
  purchase_date                DateTime?                      @db.Date
  purchase_store               String?                        @db.VarChar(255)
  purchase_amount              Decimal?                       @db.Decimal(10, 2)
  receipt_file_url             String?
  receipt_ocr_data             Json?
  warranty_start_date          DateTime?                      @db.Date
  warranty_end_date            DateTime?                      @db.Date
  status                       String?                        @default("pending") @db.VarChar(50)
  rejection_reason             String?
  created_at                   DateTime?                      @default(now()) @db.Timestamptz(6)
  updated_at                   DateTime?                      @default(now()) @db.Timestamptz(6)
  wrs_pro_installations        wrs_pro_installations[]
  wrs_pro_moderation_queue     wrs_pro_moderation_queue[]
  wrs_pro_registration_serials wrs_pro_registration_serials[]
  wrs_pro_customers            wrs_pro_customers?             @relation(fields: [customer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  wrs_pro_products             wrs_pro_products?              @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  wrs_pro_rewards              wrs_pro_rewards[]
  wrs_pro_support_tickets      wrs_pro_support_tickets[]

  @@index([customer_id], map: "idx_registrations_customer_id")
  @@index([primary_serial], map: "idx_registrations_serial")
  @@index([status], map: "idx_registrations_status")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model wrs_pro_rewards {
  id                             String                           @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  registration_id                String?                          @db.Uuid
  campaign_id                    String?                          @db.Uuid
  customer_id                    String?                          @db.Uuid
  reward_type                    String                           @db.VarChar(50)
  reward_value                   Decimal?                         @db.Decimal(10, 2)
  reward_description             String?
  status                         String?                          @default("pending") @db.VarChar(50)
  delivery_address               String?
  delivery_city                  String?                          @db.VarChar(100)
  delivery_state                 String?                          @db.VarChar(100)
  delivery_postcode              String?                          @db.VarChar(10)
  tracking_number                String?                          @db.VarChar(100)
  shipped_at                     DateTime?                        @db.Timestamptz(6)
  delivered_at                   DateTime?                        @db.Timestamptz(6)
  voucher_code                   String?                          @db.VarChar(100)
  voucher_url                    String?
  claimed_at                     DateTime?                        @db.Timestamptz(6)
  created_at                     DateTime?                        @default(now()) @db.Timestamptz(6)
  updated_at                     DateTime?                        @default(now()) @db.Timestamptz(6)
  wrs_pro_identity_verifications wrs_pro_identity_verifications[]
  wrs_pro_campaigns              wrs_pro_campaigns?               @relation(fields: [campaign_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  wrs_pro_customers              wrs_pro_customers?               @relation(fields: [customer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  wrs_pro_registrations          wrs_pro_registrations?           @relation(fields: [registration_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([customer_id], map: "idx_rewards_customer_id")
  @@index([status], map: "idx_rewards_status")
}

model wrs_pro_support_tickets {
  id                    String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  customer_id           String?                @db.Uuid
  registration_id       String?                @db.Uuid
  subject               String?                @db.VarChar(255)
  description           String?
  category              String?                @db.VarChar(100)
  priority              String?                @default("normal") @db.VarChar(20)
  status                String?                @default("open") @db.VarChar(50)
  assigned_to           String?                @db.Uuid
  resolved_at           DateTime?              @db.Timestamptz(6)
  created_at            DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?              @default(now()) @db.Timestamptz(6)
  wrs_pro_customers     wrs_pro_customers?     @relation(fields: [customer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  wrs_pro_registrations wrs_pro_registrations? @relation(fields: [registration_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([status], map: "idx_support_tickets_status")
}

model slotiva_appointments {
  id                   String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  booking_id           String                 @unique @default(dbgenerated("('BK-'::text || (EXTRACT(epoch FROM now()))::integer)")) @db.VarChar(50)
  client_name          String                 @db.VarChar(255)
  phone                String?                @db.VarChar(20)
  email                String?                @db.VarChar(255)
  start_time           DateTime               @db.Timestamptz(6)
  end_time             DateTime               @db.Timestamptz(6)
  status               String                 @default("confirmed") @db.VarChar(20)
  calendar_event_id    String?                @db.VarChar(255)
  reminder_sent        Boolean?               @default(false)
  reminder_sent_at     DateTime?              @db.Timestamptz(6)
  notes                String?
  created_at           DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?              @default(now()) @db.Timestamptz(6)
  created_by           String?                @db.VarChar(50)
  service_type_id      String?                @db.Uuid
  slotiva_service_type slotiva_service_types? @relation(fields: [service_type_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  slotiva_audit_logs   slotiva_audit_logs[]

  @@index([start_time], map: "idx_slotiva_appointments_start_time")
  @@index([status], map: "idx_slotiva_appointments_status")
  @@index([email], map: "idx_slotiva_appointments_email")
  @@index([phone], map: "idx_slotiva_appointments_phone")
  @@index([booking_id], map: "idx_slotiva_appointments_booking_id")
  @@index([service_type_id], map: "idx_slotiva_appointments_service_type_id")
  @@map("slotiva_appointments")
}

model slotiva_conversation_sessions {
  id                            String                          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  session_id                    String                          @unique @db.VarChar(255)
  channel                       String?                         @db.VarChar(50)
  phone                         String?                         @db.VarChar(20)
  email                         String?                         @db.VarChar(255)
  started_at                    DateTime?                       @default(now()) @db.Timestamptz(6)
  last_activity                 DateTime?                       @default(now()) @db.Timestamptz(6)
  slotiva_conversation_messages slotiva_conversation_messages[]

  @@index([session_id], map: "idx_slotiva_sessions_session_id")
  @@index([phone], map: "idx_slotiva_sessions_phone")
  @@index([email], map: "idx_slotiva_sessions_email")
  @@map("slotiva_conversation_sessions")
}

model slotiva_conversation_messages {
  id                            String                        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  session_id                    String                        @db.Uuid
  role                          String                        @db.VarChar(20)
  message                       String
  tool_calls                    Json?
  created_at                    DateTime?                     @default(now()) @db.Timestamptz(6)
  slotiva_conversation_sessions slotiva_conversation_sessions @relation(fields: [session_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([session_id], map: "idx_slotiva_messages_session_id")
  @@index([created_at], map: "idx_slotiva_messages_created_at")
  @@map("slotiva_conversation_messages")
}

model slotiva_audit_logs {
  id                   String                @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  appointment_id       String?               @db.Uuid
  action_type          String                @db.VarChar(50)
  action_description   String?
  user_input           Json?
  ai_response          Json?
  tool_calls           Json?
  session_id           String?               @db.VarChar(255)
  channel              String?               @db.VarChar(50)
  created_at           DateTime?             @default(now()) @db.Timestamptz(6)
  slotiva_appointments slotiva_appointments? @relation(fields: [appointment_id], references: [id], onUpdate: NoAction)

  @@index([appointment_id], map: "idx_slotiva_audit_appointment_id")
  @@index([action_type], map: "idx_slotiva_audit_action_type")
  @@index([created_at], map: "idx_slotiva_audit_created_at")
  @@index([session_id], map: "idx_slotiva_audit_session_id")
  @@map("slotiva_audit_logs")
}

model slotiva_service_types {
  id                   String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                 String                 @unique @db.VarChar(255)
  description          String?
  duration_minutes     Int                    @default(60)
  is_active            Boolean                @default(true)
  created_at           DateTime               @default(now()) @db.Timestamptz(6)
  updated_at           DateTime               @default(now()) @updatedAt @db.Timestamptz(6)
  slotiva_appointments slotiva_appointments[]

  @@map("slotiva_service_types")
}

model lend_lyx_applicants {
  id                     String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  application_id         String                 @db.Uuid
  session_id             String                 @db.Uuid
  full_name              String
  ic_number              String
  date_of_birth          DateTime               @db.Date
  email                  String
  phone                  String?
  marital_status         String?
  tin_no                 String
  citizenship            String
  address                String?
  city                   String?
  state                  String?
  postcode               String?
  status                 String?                @default("pending")
  created_at             DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at             DateTime?              @default(now()) @db.Timestamptz(6)
  lend_lyx_applications  lend_lyx_applications  @relation(fields: [application_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  lend_lyx_chat_sessions lend_lyx_chat_sessions @relation(fields: [session_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model lend_lyx_applications {
  id                   String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  interest_rate        Decimal?               @db.Decimal(5, 4)
  tenure_months        Int?
  loan_amount          Decimal                @db.Decimal(12, 2)
  loan_purpose         String
  remarks              String?
  status               String?                @default("pending")
  action_date          DateTime?              @db.Timestamptz(6)
  created_at           DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at           DateTime?              @default(now()) @db.Timestamptz(6)
  reference_no         String                 @unique
  lend_lyx_applicants  lend_lyx_applicants[]
  lend_lyx_audit_logs  lend_lyx_audit_logs[]
  lend_lyx_compliance  lend_lyx_compliance[]
  lend_lyx_documents   lend_lyx_documents[]
  lend_lyx_employments lend_lyx_employments[]
  lend_lyx_financials  lend_lyx_financials[]
}

model lend_lyx_audit_logs {
  id                    String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  application_id        String                @db.Uuid
  action                String
  old_value             Json?
  new_value             Json?
  ip_address            String?               @db.Inet
  user_agent            String?
  created_at            DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?             @default(now()) @db.Timestamptz(6)
  lend_lyx_applications lend_lyx_applications @relation(fields: [application_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model lend_lyx_chat_messages {
  id                     String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  session_id             String                 @db.Uuid
  role                   String
  type                   String                 @default("text")
  content                String
  created_at             DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at             DateTime?              @default(now()) @db.Timestamptz(6)
  lend_lyx_chat_sessions lend_lyx_chat_sessions @relation(fields: [session_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model lend_lyx_chat_sessions {
  id                     String                   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                   String
  telegram_chat_id       String
  telegram_user_name     String
  is_active              Boolean?                 @default(true)
  started_at             DateTime?                @db.Timestamptz(6)
  last_interacted_at     DateTime?                @db.Timestamptz(6)
  created_at             DateTime?                @default(now()) @db.Timestamptz(6)
  updated_at             DateTime?                @default(now()) @db.Timestamptz(6)
  lend_lyx_applicants    lend_lyx_applicants[]
  lend_lyx_chat_messages lend_lyx_chat_messages[]
}

model lend_lyx_compliance {
  id                    String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  application_id        String                @db.Uuid
  aml_status            String?               @default("pending")
  ofac_check            Boolean?              @default(false)
  disclosures_accepted  Boolean?              @default(false)
  consent_given_at      DateTime?             @db.Timestamptz(6)
  remarks               String?
  created_at            DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?             @default(now()) @db.Timestamptz(6)
  lend_lyx_applications lend_lyx_applications @relation(fields: [application_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model lend_lyx_documents {
  id                    String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  application_id        String                @db.Uuid
  doc_type              String
  file_path             String
  file_name             String
  file_size             BigInt?
  ocr_data              Json?
  status                String?               @default("pending")
  remarks               String?
  created_at            DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?             @default(now()) @db.Timestamptz(6)
  lend_lyx_applications lend_lyx_applications @relation(fields: [application_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model lend_lyx_employments {
  id                    String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  application_id        String                @db.Uuid
  employer_name         String?
  employer_phone        String?
  employment_status     String
  position              String?
  start_date            DateTime?             @db.Date
  end_date              DateTime?             @db.Date
  monthly_income        Decimal               @db.Decimal(10, 2)
  created_at            DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?             @default(now()) @db.Timestamptz(6)
  lend_lyx_applications lend_lyx_applications @relation(fields: [application_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model lend_lyx_financials {
  id                    String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  application_id        String                @db.Uuid
  monthly_expenses      Decimal               @db.Decimal(10, 2)
  total_assets          Decimal?              @default(0) @db.Decimal(12, 2)
  total_liabilities     Decimal?              @default(0) @db.Decimal(12, 2)
  debt_to_income_ratio  Decimal?              @db.Decimal(5, 4)
  credit_score          Int?
  bank_name             String?
  bank_account_number   String?
  created_at            DateTime?             @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?             @default(now()) @db.Timestamptz(6)
  lend_lyx_applications lend_lyx_applications @relation(fields: [application_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model vistate_agents {
  id                                String                              @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name                              String                              @db.VarChar(255)
  email                             String                              @unique @db.VarChar(255)
  phone                             String                              @db.VarChar(50)
  working_hours                     Json?                               @default("{\"friday\": {\"end\": \"18:00\", \"start\": \"09:00\"}, \"monday\": {\"end\": \"18:00\", \"start\": \"09:00\"}, \"sunday\": null, \"tuesday\": {\"end\": \"18:00\", \"start\": \"09:00\"}, \"saturday\": {\"end\": \"14:00\", \"start\": \"10:00\"}, \"thursday\": {\"end\": \"18:00\", \"start\": \"09:00\"}, \"wednesday\": {\"end\": \"18:00\", \"start\": \"09:00\"}}")
  is_active                         Boolean?                            @default(true)
  created_at                        DateTime?                           @default(now()) @db.Timestamptz(6)
  telegram_chat_id                  String?                             @db.VarChar(100)
  telegram_username                 String?                             @db.VarChar(100)
  telegram_linked_at                DateTime?                           @db.Timestamptz(6)
  telegram_registration_code        String?                             @db.VarChar(20)
  notification_enabled              Boolean?                            @default(true)
  last_notified_at                  DateTime?                           @db.Timestamptz(6)
  vistate_agent_availability_blocks vistate_agent_availability_blocks[]
  vistate_notification_logs         vistate_notification_logs[]
  vistate_properties                vistate_properties[]
  vistate_viewing_appointments      vistate_viewing_appointments[]
  vistate_communication_log         vistate_communication_log[]
}

model vistate_property_types {
  id                 String               @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name               String               @db.VarChar(100)
  category           String               @db.VarChar(50)
  vistate_properties vistate_properties[]
}

model vistate_properties {
  id                                   String                                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  property_type_id                     String?                                @db.Uuid
  agent_id                             String?                                @db.Uuid
  title                                String                                 @db.VarChar(255)
  reference_code                       String?                                @unique @db.VarChar(50)
  address                              String
  area                                 String?                                @db.VarChar(100)
  listing_type                         String                                 @db.VarChar(20)
  price                                Decimal?                               @db.Decimal(15, 2)
  bedrooms                             Int?
  bathrooms                            Int?
  size_sqft                            Int?
  status                               String?                                @default("available") @db.VarChar(50)
  created_at                           DateTime?                              @default(now()) @db.Timestamptz(6)
  min_notice_hours                     Int?                                   @default(24)
  max_daily_viewings                   Int?                                   @default(8)
  viewing_duration_minutes             Int?                                   @default(30)
  vistate_agents                       vistate_agents?                        @relation(fields: [agent_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  vistate_property_types               vistate_property_types?                @relation(fields: [property_type_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  vistate_property_availability_blocks vistate_property_availability_blocks[]
  vistate_viewing_appointments         vistate_viewing_appointments[]

  @@index([status], map: "vistate_idx_properties_status")
  @@index([agent_id], map: "vistate_idx_properties_agent")
}

model vistate_clients {
  id                           String                         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name                         String                         @db.VarChar(255)
  phone                        String                         @unique @db.VarChar(50)
  email                        String?                        @db.VarChar(255)
  preferred_contact            String?                        @default("whatsapp") @db.VarChar(20)
  telegram_id                  String?                        @db.VarChar(100)
  created_at                   DateTime?                      @default(now()) @db.Timestamptz(6)
  budget_min                   Decimal?                       @db.Decimal(15, 2)
  budget_max                   Decimal?                       @db.Decimal(15, 2)
  preferred_areas              String[]
  lead_score                   Int?                           @default(50)
  vistate_viewing_appointments vistate_viewing_appointments[]
  vistate_communication_log    vistate_communication_log[]

  @@index([phone], map: "vistate_idx_clients_phone")
}

model vistate_viewing_appointments {
  id                        String                      @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  booking_reference         String                      @unique @db.VarChar(20)
  property_id               String                      @db.Uuid
  client_id                 String                      @db.Uuid
  agent_id                  String?                     @db.Uuid
  scheduled_datetime        DateTime                    @db.Timestamptz(6)
  duration_minutes          Int?                        @default(30)
  status                    String?                     @default("pending") @db.VarChar(50)
  booking_channel           String?                     @db.VarChar(50)
  notes                     String?
  created_at                DateTime?                   @default(now()) @db.Timestamptz(6)
  vistate_notification_logs vistate_notification_logs[]
  vistate_agents            vistate_agents?             @relation(fields: [agent_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  vistate_clients           vistate_clients             @relation(fields: [client_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  vistate_properties        vistate_properties          @relation(fields: [property_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  vistate_viewing_feedback  vistate_viewing_feedback?
  vistate_communication_log vistate_communication_log[]

  @@index([scheduled_datetime], map: "vistate_idx_appointments_datetime")
  @@index([status], map: "vistate_idx_appointments_status")
  @@index([agent_id], map: "vistate_idx_appointments_agent")
  @@index([property_id], map: "vistate_idx_appointments_property")
  @@index([client_id], map: "vistate_idx_appointments_client")
}

model vistate_viewing_feedback {
  id                           String                       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  appointment_id               String                       @unique @db.Uuid
  rating                       Int?
  interest_level               String?                      @db.VarChar(50)
  comments                     String?
  created_at                   DateTime?                    @default(now()) @db.Timestamptz(6)
  vistate_viewing_appointments vistate_viewing_appointments @relation(fields: [appointment_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model vistate_agent_availability_blocks {
  id             String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  agent_id       String         @db.Uuid
  start_datetime DateTime       @db.Timestamptz(6)
  end_datetime   DateTime       @db.Timestamptz(6)
  reason         String?        @db.VarChar(100)
  vistate_agents vistate_agents @relation(fields: [agent_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model v_agent {
  id            String? @db.Uuid
  name          String? @db.VarChar(255)
  working_hours Json?

  @@ignore
}

model vistate_notification_logs {
  id                           String                        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  agent_id                     String?                       @db.Uuid
  booking_id                   String?                       @db.Uuid
  notification_type            String                        @db.VarChar(50)
  channel                      String                        @default("telegram") @db.VarChar(50)
  status                       String                        @default("pending") @db.VarChar(50)
  message_content              String?
  telegram_message_id          String?                       @db.VarChar(100)
  error_message                String?
  created_at                   DateTime?                     @default(now()) @db.Timestamptz(6)
  sent_at                      DateTime?                     @db.Timestamptz(6)
  delivered_at                 DateTime?                     @db.Timestamptz(6)
  vistate_agents               vistate_agents?               @relation(fields: [agent_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  vistate_viewing_appointments vistate_viewing_appointments? @relation(fields: [booking_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([agent_id], map: "idx_notification_logs_agent")
  @@index([booking_id], map: "idx_notification_logs_booking")
}

model vistate_property_availability_blocks {
  id                 String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  property_id        String             @db.Uuid
  start_datetime     DateTime           @db.Timestamptz(6)
  end_datetime       DateTime           @db.Timestamptz(6)
  reason             String?            @db.VarChar(100)
  vistate_properties vistate_properties @relation(fields: [property_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model vistate_communication_log {
  id             String                        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  client_id      String?                       @db.Uuid
  appointment_id String?                       @db.Uuid
  agent_id       String?                       @db.Uuid
  session_id     String?                       @db.VarChar(100)
  channel        String                        @db.VarChar(50)
  direction      String                        @db.VarChar(10)
  message_type   String?                       @db.VarChar(50)
  content        String
  metadata       Json?
  delivered_at   DateTime?                     @db.Timestamptz(6)
  read_at        DateTime?                     @db.Timestamptz(6)
  failed         Boolean?                      @default(false)
  error_message  String?
  created_at     DateTime?                     @default(now()) @db.Timestamptz(6)
  ai_intent      String?                       @db.VarChar(100)
  ai_confidence  Decimal?                      @db.Decimal(3, 2)
  vistate_clients              vistate_clients?              @relation(fields: [client_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  vistate_viewing_appointments vistate_viewing_appointments? @relation(fields: [appointment_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  vistate_agents               vistate_agents?               @relation(fields: [agent_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([client_id, created_at(sort: Desc)], map: "idx_comm_log_client_date")
  @@index([appointment_id, created_at(sort: Desc)], map: "idx_comm_log_appointment")
  @@index([channel, created_at(sort: Desc)], map: "idx_comm_log_channel_date")
  @@index([session_id], map: "idx_comm_log_session")
}
